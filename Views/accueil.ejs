<html>
<head>
  <title>Accueil</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css?family=Anaheim|Roboto" rel="stylesheet">

  <!-- Feuille de style -->
  <link type="text/css" href="css/style.css" rel="stylesheet" />

  <!-- JavaScript -->
  <!-- <script src="js/script.js" type="text/javascript"></script> -->
  <!-- <script type="text/javascript" src="/socket.io/socket.io.js"></script>-->

</head>
<body>
  <header>
    <h1>Bienvenu sur notre super site</h1>
    <div id="menu">
      <ul id="menu_horizontal">
        <li><a href="">Accueil</a></li>
        <li><a href="connexion">Connexion</a></li>
        <li><a href="creerQuestionnaire">Créer un questionnaire</a></li>
        <li><a href="finQuestion">Test finQuestion</a></li>
        <li><a href="attente">Test Attente</a></li>
        <li><a href="listeParticipants">Test liste participants</a></li>
        <li><a href="questionnaires">Test voir mes questionnaires</a></li>
        <li><a href="questionnaire">Test voir un questionnaire</a></li>
        <li><a href="question">Test question</a></li>
        <li><a href="reponse">Test reponse</a></li>
      </ul>
    </div>
  </header>
  <footer>
    <p>By Valentin, Baptise & Benoit</p>
  </footer>
</body>
<script src="js/jquery-3.3.1.min.js" type="text/javascript"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="../Classes/Questionnaire.js" type="text/javascript"></script>
<script>
    // js pour le questionnaire

    var socket = null;

    var questionnaireId = null;
    var motDePasse = null;

    /**
     *
     * @param question
     */
    function afficherQuestion(question){
        // Todo : afficher la nouvelle question
    }

    /**
     *
     */
    function envoyerReponse(reponse){
        // Todo : envoyer une réponse
        socket.emit("answerQuestion", null);
    }

    function initialisationConnexion(){
        // Identification
        // Todo
        socket.emit("identify", null);

        socket.on('connectionSuccess', function (data) {
            // Connexion au questionnaire
            console.log("connection réussi");
            socket.emit("connectToQuestioning", {"questionnaireId": questionnaireId, "motDePasse": motDePasse});
        });
    }

    $(function () {
        // ------------------------------------------------------------------------------------------
        // initialisation de la connexion
        // ------------------------------------------------------------------------------------------

        socket = io.connect();

        questionnaireId = null; // Todo : le récupérer
        motDePasse = null; // Todo : le récupérer

        initialisationConnexion();

        // ------------------------------------------------------------------------------------------



        // Réception d'une nouvelle question
        socket.on('newQuestion', function(data){
            // Todo : récupérer la question
            console.log("test new question");
            afficherQuestion(null);
        });

        // Demande d'arret des réponses
        socket.on('stopAnswerQuestion', function(data){
            // Todo : afficher quelque chose car on ne peut plus répondre à la question
            console.log("test stop question");
        });

        // Réception des résultats
        socket.on('showResultQuestion', function(data){
            // Todo : afficher les résultats
            console.log("test stop question");
        });

        // Une erreur
        socket.on('error', function(data){
            console.log("Erreur : ");
            console.log(data);
        });

        // Le serveur n'est plus joignable
        socket.on('disconnect', function(data){
            // Todo : afficher un message
            console.log("test deconnecté");
        });

        // Serveur de retour joignable
        socket.on('reconnect', function(data){
            // Todo : afficher un message
            console.log("test reconnect");
            initialisationConnexion();
        });
    });
</script>
</html>
